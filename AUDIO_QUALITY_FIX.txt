================================================================================
  ğŸµ FIX AUDIO QUALITY - BÃ€I HÃT LIÃŠN Tá»¤C HÆ N
================================================================================

NGÃ€Y: 2026-01-31


Váº¤N Äá»€ TRC ÄÃ“:
================================================================================

1. âŒ BÃ i hÃ¡t KHÃ”NG LIÃŠN Tá»¤C - bá»‹ Ä‘á»©t quÃ£ng giá»¯a cÃ¡c cÃ¢u
2. âŒ Bá»Š NGáº®T NHá»ŠP - transitions khÃ´ng smooth
3. âŒ NHIá»€U GIá»ŒNG LOáº N - volume khÃ´ng Ä‘á»“ng Ä‘á»u giá»¯a cÃ¡c line


NGUYÃŠN NHÃ‚N:
================================================================================

1. Fade in/out quÃ¡ ngáº¯n (50ms) â†’ click sounds
2. KHÃ”NG CÃ“ CROSSFADE giá»¯a cÃ¡c cÃ¢u â†’ Ã¢m thanh cáº¯t gÃ£y
3. Spacing quÃ¡ Ã­t cho Ballad/Soul (1.5 beats) â†’ cáº£m giÃ¡c vá»™i vÃ£
4. Volume khÃ´ng normalize giá»¯a cÃ¡c line â†’ line to, line nhá»


ÄÃƒ FIX:
================================================================================

âœ… 1. CROSSFADE GIá»®A CÃC CÃ‚U (300ms)
   - Ã‚m thanh tá»« cÃ¢u nÃ y "cháº£y" sang cÃ¢u kia
   - KhÃ´ng cÃ²n cáº¯t gÃ£y Ä‘á»™t ngá»™t
   
   Code:
   ```python
   if len(full_vocal) > 0 and idx > 0:
       full_vocal = full_vocal.append(seg, crossfade=300)
   ```

âœ… 2. TÄ‚NG FADE IN/OUT (50ms â†’ 150ms)
   - MÆ°á»£t mÃ  hÆ¡n khi báº¯t Ä‘áº§u/káº¿t thÃºc má»—i cÃ¢u
   - Loáº¡i bá» click sounds
   
   Code:
   ```python
   fade_ms = 150  # TÄƒng tá»« 50ms
   seg = seg.fade_in(fade_ms).fade_out(fade_ms)
   ```

âœ… 3. TÄ‚NG SPACING CHO BALLAD/SOUL
   - Ballad: 1.5 â†’ 2.5 beats (tÄƒng 67%)
   - Default: 1.0 â†’ 1.5 beats (tÄƒng 50%)
   - Rap váº«n giá»¯ 0.5 beats (tight)
   
   Code:
   ```python
   if style in ["Ballad", "Soul", "Jazz", "Blues"]:
       line_spacing_beats = 2.5  # Breathe room!
   ```

âœ… 4. NORMALIZE VOLUME GIá»®A CÃC LINE
   - Má»—i line Ä‘Æ°á»£c normalize vá» -20dBFS
   - Volume Ä‘á»“ng Ä‘á»u, khÃ´ng cÃ³ line to/nhá»
   
   Code:
   ```python
   target_dBFS = -20.0
   change_in_dBFS = target_dBFS - seg.dBFS
   seg = seg.apply_gain(change_in_dBFS)
   ```


Káº¾T QUáº¢ MONG Äá»¢I:
================================================================================

âœ… BÃ i hÃ¡t LIÃŠN Tá»¤C, khÃ´ng cÃ²n Ä‘á»©t quÃ£ng
âœ… Transitions MÆ¯á»¢T MÃ€ giá»¯a cÃ¡c cÃ¢u
âœ… Volume Äá»’NG Äá»€U, khÃ´ng cÃ³ line to/nhá»
âœ… Spacing PHÃ™ Há»¢P vá»›i tá»«ng style:
   - Ballad/Soul: ThÆ° thÃ¡i, cÃ³ breathe room
   - Rap: Tight, nhanh
   - Pop/Rock: Vá»«a pháº£i

âœ… Ã‚m thanh CHUYÃŠN NGHIá»†P hÆ¡n, giá»‘ng studio recording!


TECHNICAL DETAILS:
================================================================================

File thay Ä‘á»•i: main.py

Locations:
- Line 781-791: Increased spacing (Ballad: 1.5â†’2.5, Default: 1.0â†’1.5)
- Line 917-928: Added normalization (-20dBFS target)
- Line 920-936: Increased fade (50â†’150ms), added crossfade (300ms)

No breaking changes - backward compatible vá»›i code hiá»‡n táº¡i.


TEST NGAY:
================================================================================

1. Deploy lÃªn Hugging Face
2. Test vá»›i style "Ballad" - lyrics cÃ³ 5-6 cÃ¢u
3. Nghe xem:
   âœ“ CÃ³ mÆ°á»£t hÆ¡n khÃ´ng?
   âœ“ CÃ³ liÃªn tá»¥c hÆ¡n khÃ´ng?
   âœ“ Volume cÃ³ Ä‘á»u khÃ´ng?


COMMIT & PUSH:
================================================================================

git add main.py
git commit -m "improve audio continuity with crossfade and normalization"
git push origin main
git push huggingface main --force


================================================================================
